import React, { useState } from 'react';
import { useUser } from './UserContext';
import { Navigate } from 'react-router-dom';

const AdminPanel: React.FC = () => {
  const { email } = useUser();
  const isLifetimeAdmin = email?.toLowerCase().trim() === 'dulat280489@gmail.com';
  
  console.log('[AdminPanel] Render - email:', email);
  console.log('[AdminPanel] isLifetimeAdmin:', isLifetimeAdmin);
  
  if (!isLifetimeAdmin) {
    return <Navigate to="/" replace />;
  }

  console.log('[AdminPanel] ‚úÖ ACCESS GRANTED - RENDERING ADMIN PANEL');

  const [userId, setUserId] = useState('');
  const [adminKey, setAdminKey] = useState('');
  const [message, setMessage] = useState('');
  const [loading, setLoading] = useState(false);

  const activatePro = async (e: React.FormEvent) => {
    e.preventDefault();
    if (!userId.trim() || !adminKey.trim()) return;

    setLoading(true);
    try {
      const response = await fetch('/api/admin/activate-pro', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ userId: userId.trim(), adminKey: adminKey.trim() })
      });

      const data = await response.json();
      if (response.ok) {
        setMessage(`‚úÖ PRO –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω –¥–ª—è ${userId}`);
        setUserId('');
      } else {
        setMessage(`‚ùå –û—à–∏–±–∫–∞: ${data.error}`);
      }
    } catch (error) {
      setMessage('‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É');
    }
    setLoading(false);
  };

  return (
    <div className="min-h-screen bg-background p-8">
      <div style={{background: 'red', color: 'white', padding: '20px', fontSize: '24px', textAlign: 'center', marginBottom: '20px'}}>
        üî• –ê–î–ú–ò–ù –ü–ê–ù–ï–õ–¨ –ó–ê–ì–†–£–ñ–ï–ù–ê! EMAIL: {email} üî•
      </div>
      <div className="max-w-2xl mx-auto">
        <h1 className="text-3xl font-bold text-text-primary mb-8">–ê–¥–º–∏–Ω –ü–∞–Ω–µ–ª—å</h1>
        
        <form onSubmit={activatePro} className="space-y-4">
          <div>
            <label className="block text-sm font-medium text-text-primary mb-1">
              User ID (email –∏–ª–∏ googleId)
            </label>
            <input
              type="text"
              value={userId}
              onChange={(e) => setUserId(e.target.value)}
              placeholder="user@example.com"
              className="w-full px-3 py-2 border border-border rounded-lg bg-background text-text-primary focus:outline-none focus:ring-2 focus:ring-primary"
              required
            />
          </div>

          <div>
            <label className="block text-sm font-medium text-text-primary mb-1">
              –ê–¥–º–∏–Ω-–∫–ª—é—á
            </label>
            <input
              type="password"
              value={adminKey}
              onChange={(e) => setAdminKey(e.target.value)}
              placeholder="admin123"
              autoComplete="current-password"
              className="w-full px-3 py-2 border border-border rounded-lg bg-background text-text-primary focus:outline-none focus:ring-2 focus:ring-primary"
              required
            />
          </div>

          <button
            type="submit"
            disabled={loading}
            className="w-full bg-primary text-primary-foreground px-4 py-2 rounded-lg hover:bg-primary-hover transition disabled:opacity-50"
          >
            {loading ? '–ê–∫—Ç–∏–≤–∞—Ü–∏—è...' : '–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å PRO'}
          </button>
        </form>

        {message && (
          <div className={`mt-4 p-3 rounded-lg text-sm ${
            message.includes('‚úÖ') 
              ? 'bg-green-100 text-green-800 border border-green-200' 
              : 'bg-red-100 text-red-800 border border-red-200'
          }`}>
            {message}
          </div>
        )}

        <div className="mt-6 text-xs text-text-secondary text-center">
          <p>–î–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ PRO –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã —á–µ—Ä–µ–∑ Kaspi Gold</p>
          <p className="mt-1">–ê–¥–º–∏–Ω-–∫–ª—é—á: admin123 (—Ç–æ–ª—å–∫–æ –¥–ª—è –¥–µ–º–æ)</p>
        </div>
      </div>
    </div>
  );
};

export default AdminPanel; 